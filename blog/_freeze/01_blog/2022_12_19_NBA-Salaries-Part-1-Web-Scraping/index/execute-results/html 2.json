{
  "hash": "3de32ce660c7fdac1e5e90f73c4f6fb4",
  "result": {
    "markdown": "---\ntitle: \"NBA Salaries - Part 1: Web-Scraping\"\ndate: \"2022-12-19\"\ncategories: [R, Web-Scraping, NBA, Data Visuals]\ntoc: true\n---\n\n\nScraping and cleaning NBA Salary data from [ESPN - NBA Players Salaries](http://www.espn.com/nba/salaries), with some simple statistic and data visuals. \n\n![](../../00_img/NBA-Money.webp)\n\n\n\n\n\n# `0.0` Introduction \n\nMoney is a crucial element in any professional sport, and NBA players are ranked among some of the highest paid athletes in the world^[[Forbes - The Worlds 10 Highest-Paid Athletes of 2022](https://www.forbes.com/sites/brettknight/2022/05/11/the-worlds-10-highest-paid-athletes-2022/?sh=77961731f6c9)]. As a data scientist, having data for NBA players salaries could go a long way in many different types of analysis, and machine learning models. It is also good to practice and experience scraping different websites, and cleaning the data. \n\n# `0.1` About The Data\n\nThis data comes from [ESPN - NBA Players Salaries](http://www.espn.com/nba/salaries). I choose this data for a number of reasons, mainly that it includes extra information such as the player position, and team they play for. \n\n# `0.2` Package Installs\n\nTo scrape and clean [ESPN - NBA Players Salaries](http://www.espn.com/nba/salaries), I will use two packages: \n\n* [rvest](https://rvest.tidyverse.org/): To scrape the data.\n\n* [tidyverse](https://www.tidyverse.org/): To gather, manipulate, and clean the data.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(rvest)\nlibrary(tidyverse)\n```\n:::\n\n\n\n# `1.0` Scraping Function \n\nSimilar to some of my other scraping function this function starts by taking in a small part of the url, in this case the `url_page`. It then uses that information to do the following: \n\n1. Pastes the `url_page` to the rest of the URL and reads the whole URL as HTML. \n2. Scrapes all the \"div\" elements off the HTML. \n3. Saves the first div element. \n4. Uses the first row of the table as the column names.\n5. Removes the duplicated rows of column names. \n6. Removes the first row of column names. \n7. Adds a POSITION column.\n8. Removes player position in NAME column \n\n\n::: {.cell}\n\n```{.r .cell-code}\nsalary.scrape <- function(url_page){\n  \" \n  This function takes in the url_page and returns a df of the table on that page.\n  \"\n  # save and read url\n  url <- base::paste0(\"http://www.espn.com/nba/salaries\", url_page)\n  html <- read_html(url)\n\n  # read table\n  div <- html %>%\n  html_elements(\"div\") %>%\n  html_table\n  \n  # only use first table the rest are repeats or empty\n  tb1 <- div[[1]]\n  \n  # use first row as column names\n  names(tb1) <- as.character(unlist(tb1[1,]))\n  \n  # remove duplicate headers\n  tb2 <- tb1 %>%\n    filter(duplicated(RK) == FALSE)\n  \n  # remove first row\n  tb3 <- tb2[-1,]\n  \n  # Add position column, and remove position from name\n  tb3$POSITION <- sub('.*, ',\"\", tb3$NAME)\n  tb3$NAME <- sub(', [A-Z]{,2}','', tb3$NAME)\n  \n  return(tb3)\n}\n```\n:::\n\n\n# `2.0` For Loop to Collect the Data into a List\n\n[ESPN - NBA Players Salaries](http://www.espn.com/nba/salaries) has 13 pages of data to scrape, so to do this quickly and efficiently I am: \n\n1. Creating a string of `url_pages`. \n2. Creating an empty list for each table to be saved in. \n3. Created a for loop to save a table for each page into the `salary_list()`. \n\n\n::: {.cell}\n\n```{.r .cell-code}\n# a string of url page extensions\nurl_pages <- c(\"\", \"/_/page/2\", \"/_/page/3\", \"/_/page/4\", \"/_/page/5\", \n               \"/_/page/6\", \"/_/page/7\", \"/_/page/8\", \"/_/page/9\", \n               \"/_/page/10\", \"/_/page/11\", \"/_/page/12\", \"/_/page/13\")\n\n# empty list\nsalary_list <- list()\n\n# pulls salary info from each url page\nfor (i in 1:length(url_pages))\n{\n  output <- salary.scrape(url_pages[[i]])\n  salary_list[[i]] <- output\n}\n```\n:::\n\n\n# `3.0` Merge Data\n\nNow that all 13 pages of data are saved into a list, I then:\n\n1. Use `rbind()` to merge all the data. \n2. Remove the last row of data, which is the column headers. \n3. Change Salary Column from character to numeric. \n\n\n::: {.cell}\n\n```{.r .cell-code}\n# combine all 13 pages into one list\nnba_salaries_2023 <- rbind(salary_list[[1]],\n                           salary_list[[2]],\n                           salary_list[[3]],\n                           salary_list[[4]],\n                           salary_list[[5]],\n                           salary_list[[6]],\n                           salary_list[[7]],\n                           salary_list[[8]],\n                           salary_list[[9]],\n                           salary_list[[10]],\n                           salary_list[[11]],\n                           salary_list[[12]],\n                           salary_list[[13]],\n                           by = c(\"RK\", \"NAME\", \"TEAM\", \"SALARY\", \"POSITION\"))\n\n# remove last row\nnba_salaries_2023 <- head(nba_salaries_2023,-1)\n```\n:::\n\n\n\n# `4.0` View Data\n\nSince we have the data, might as well look at it and play with it a little. To start lets just see the highest paid NBA players: \n\n\n::: {.cell}\n\n```{.r .cell-code}\nutils::head(nba_salaries_2023, 10)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 10 Ã— 5\n   RK    NAME                  TEAM                   SALARY      POSITION\n   <chr> <chr>                 <chr>                  <chr>       <chr>   \n 1 1     Stephen Curry         Golden State Warriors  $48,070,014 PG      \n 2 2     Russell Westbrook     Los Angeles Lakers     $47,063,478 PG      \n 3 3     LeBron James          Los Angeles Lakers     $44,474,988 SF      \n 4 4     Kevin Durant          Brooklyn Nets          $44,119,845 PF      \n 5 5     Bradley Beal          Washington Wizards     $43,279,250 SG      \n 6 6     Damian Lillard        Portland Trail Blazers $42,492,492 PG      \n 7 7     Giannis Antetokounmpo Milwaukee Bucks        $42,492,492 PF      \n 8 8     Kawhi Leonard         LA Clippers            $42,492,492 SF      \n 9 9     Paul George           LA Clippers            $42,492,492 SG      \n10 10    Klay Thompson         Golden State Warriors  $40,600,080 SG      \n```\n:::\n:::\n\n\n## `4.1` Change Salaray from Character to Numeric\n\nNotice that the SALARY column is a character value. This will not be helpful when trying to do math, or make graphs with this numerical data. To change this 3 things must be addressed:\n\n1. Removing the dollar sign.\n2. Removing the commas.\n3. Change character type to numeric. \n\n\n::: {.cell}\n\n```{.r .cell-code}\nnba_salaries_2023$SALARY <- str_remove_all(nba_salaries_2023$SALARY,\n                    \"\\\\$\")\nnba_salaries_2023$SALARY <- str_remove_all(nba_salaries_2023$SALARY,\n                    \",\")\nnba_salaries_2023$SALARY <- as.numeric(nba_salaries_2023$SALARY)\n```\n:::\n\n\nNow we are able to do math, make graphs, and arrange the data by salary. \n\n## `4.2` Basic Statistics\n\n\n::: {.cell}\n\n:::\n\n\n1. Highest paid value : 48,070,014\n2. Lowest paid value : 5,318\n3. Median : 4,043,639\n4. Mean : 8,599,110\n5. Standard Deviation : 10,152,995\n\n## `4.3` Box Plots\n\n### `4.3.1` 2022 - 2023 Yearly Salary by Postion \n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot2::ggplot(data = nba_salaries_2023,\n                mapping = ggplot2::aes(x = SALARY,\n                                       y = POSITION)) + \n  ggplot2::geom_boxplot()\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-8-1.png){width=672}\n:::\n:::\n\n\nFrom this visual we can see that Point Guards (PG) appear to be paid the most, while Guards (G) and Forwards (F) on average are paid the least. \n\n### `4.4` 2022-2023 Yearly Salary by Team\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot2::ggplot(data = nba_salaries_2023,\n                mapping = ggplot2::aes(x = SALARY,\n                                       y = TEAM)) + \n  ggplot2::geom_boxplot()\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-9-1.png){width=672}\n:::\n:::\n\n\nThis plot is not the easiest to read, and might be worth sub-setting the information further. However eye-balling this visual we can see most teams pay between `$`2,000,000 and `$`15,000,000 per player with a few outliers. These outliers of course being superstar players.\n\n# `5.0` Save Data\n\nLastly, it is important to save the data to work with in the future. To do this I used the `write.csv()` function to save the data as a csv. \n\n\n::: {.cell}\n\n```{.r .cell-code}\nutils::write.csv(nba_salaries_2023, \n                 paste0(\"../../00_data/\",\n                        base::Sys.Date(),\n                        \"_NBA_22-23_Salaries.csv\"))\n```\n:::\n",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}