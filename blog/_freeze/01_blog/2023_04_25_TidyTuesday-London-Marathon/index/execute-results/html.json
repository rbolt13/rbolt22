{
  "hash": "d8046c1bb59166a3683f95403a8f64e2",
  "result": {
    "markdown": "---\ntitle: \"Week 17 Tidy Tuesday: London Marathon\"\ndate: \"2023-04-25\"\ncategories: [\"#TidyTuesday\", R]\ndraft: false\n---\n\n\nIn this week's [#TidyTuesday](https://github.com/rfordatascience/tidytuesday) submission I delve into London Marathon data, unveiling the number of winners by nationality throughout the marathon's history. \n\n# London Marathon \n\nThe data this week comes from Nicola Rennie's [LondonMarathon R package](https://github.com/nrennie/LondonMarathon). This is an R package containing two data sets scraped from Wikipedia (1 November 2022) on London Marathon winners, and some general data. How the dataset was created, and some analysis, is described in Nicola's post [\"Scraping London Marathon data with {rvest}\"](https://nrennie.rbind.io/blog/web-scraping-rvest-london-marathon/). Thank you for putting this dataset together @nrennie!\n\n![](plot.png)\n\n# Code\n\nThis week I wanted to add flags for each nationality, so two more functions are added to this weeks workflow: \n\n* `flags()`: which reads in each flags .pgn, and saves them as a list. \n\n* `add_flag()`: reads in the list of flags, and overlays the images on the graph. \n\nAdditionally are the three key functions: cleaning, visualizing, and styling, as well as the index.R file which integrates data loading, function execution, and the generation of of a data visualization.\n\n::: {.panel-tabset}\n\n### Cleaning\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"Show Code\"}\n#### Load Packages ####\nlibrary(dplyr)\nlibrary(magrittr)\n\n#### Cleaning Function ####\nclean <- function(data){\n  clean_data <- data %>%\n    dplyr::group_by(Nationality) %>%\n    dplyr::summarise(\n      nat_winners = dplyr::n()) %>%\n    dplyr::arrange(\n      dplyr::desc(nat_winners))\n  return(clean_data)\n}\n```\n:::\n\n\n### Visualizing\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"Show Code\"}\n#### Load Packages ####\nlibrary(ggplot2)\n\n#### Load Colors ####\ngeom_bar_color <- \"#DD733A\"\n\n#### Visual Function ####\nvis <- function(df){\n  vis <- ggplot2::ggplot(\n    df,\n    ggplot2::aes(\n      x = nat_winners,\n      y = stats::reorder(\n        Nationality, \n        nat_winners))) +\n    ggplot2::geom_bar(\n      stat = \"identity\",\n      fill = geom_bar_color)\n  return(vis)\n}\n```\n:::\n\n\n### Styling\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"Show Code\"}\n#### Load Packages ####\nlibrary(ggplot2)\n\n#### Load Colors ####\nbackground_color <- \"#596D78\"\ntitle_color <- \"#ABB3B8\"\ngraph_color <- \"#ABB3B8\"\nbonus_1 <- \"#4F555B\"\nbonus_2 <- \"#B4AE59\"\n\n#### Style Function ####\nstyle <- function(vis){\n  sty <- vis +\n    # labels\n    ggplot2::labs(\n      title = \"Nationality of London Marathon Winners\",\n      subtitle = \"\",\n      caption = \"Graph by Randi Bolt \\n Data from #TidyTuesday\",\n      x = \"Number of Winners\",\n      y = \"\") +\n    # values next to bars\n    ggplot2::geom_text(\n      ggplot2::aes(label = nat_winners,\n                   hjust = 1.2)) +\n    ggplot2::theme(\n      # title\n      plot.title = element_text(\n        size = 18,\n        face = \"bold\",\n        color = title_color,\n        hjust = .5),\n      # caption \n      plot.caption = element_text(\n        color = title_color),\n      # graph background\n      panel.background = element_rect(\n        fill = graph_color),\n      # x and y axis labels\n      axis.title = element_text(\n        size = 14, \n        color = title_color),\n      # axis ticks text\n      axis.text = element_text(\n        siz = 10,\n        color = title_color),\n      # background\n      plot.backgroun = ggplot2::element_rect(\n        fill = background_color\n      )\n    )\n  return(sty)\n}\n```\n:::\n\n\n### Flags\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"Show Code\"}\n#### Load Packages ####\nbase::library(png)\n\n#### Load Flags ####\nuk <-  readPNG(\"flags/uk.png\")   \nkenya <-  readPNG(\"flags/kenya.png\") \nusa <-  readPNG(\"flags/usa.png\")\nswi <-  readPNG(\"flags/switzerland.png\")\nethi <-  readPNG(\"flags/ethiopia.png\")\nnor <-  readPNG(\"flags/norway.png\")\nire <-  readPNG(\"flags/ireland.png\")\nmex <-  readPNG(\"flags/mexico.png\")\ngermany <-  readPNG(\"flags/germany.png\") \nport <-  readPNG(\"flags/portugal.png\")\nitaly <-  readPNG(\"flags/italy.png\")\ncan <-  readPNG(\"flags/canada.png\")\nsweden <-  readPNG(\"flags/sweden.png\")\njapan <-  readPNG(\"flags/japan.png\")\nfran <-  readPNG(\"flags/france.png\")\ndenmark <-  readPNG(\"flags/denmark.png\")\naus <-  readPNG(\"flags/australia.png\")\npol <- readPNG(\"flags/poland.png\")\nneth <- readPNG(\"flags/netherlands.png\")\nmor <- readPNG(\"flags/morocco.png\")\nspain <- readPNG(\"flags/spain.png\")\nsu <- readPNG(\"flags/soviet_union.png\")\nchina <- readPNG(\"flags/china.png\")\nbel <- readPNG(\"flags/belgium.png\")\n\n#### Flag List ####\nflag_list <- list(\n  uk, kenya, usa,\n  swi, ethi, nor,\n  ire, mex, germany,\n  port, italy, can,\n  sweden, japan, fran,\n  denmark, aus, pol,\n  neth, mor, spain,\n  su, china, bel)\n\n#### Save Flags ####\nsaveRDS(flag_list, file=\"data/flag_list.RData\")\n```\n:::\n\n\n### Add Flags\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"Show Code\"}\n#### Load Packages #### \nlibrary(ggplot2)\nlibrary(grid)\n\n#### Load Data ####\nflags_list <- readRDS(\"data/flag_list.RData\")\n\n#### Add Flags ####\nadd_flags <- function(styled_vis){\n  for (i in 1:length(flags_list)){\n    flag_new <- styled_vis + \n      # add static annotation\n      ggplot2::annotation_custom(\n        # cycles through list and stacking flags on graph\n        grid::rasterGrob(\n          flags_list[[i]], \n          width=1, height=1),\n        xmin = -2, xmax = -.1,\n        ymin = 24.55-i, ymax = 25.45-i)\n    styled_vis <- flag_new\n  }\n  return(flag_new)\n}\n```\n:::\n\n\n### index.R\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"Show Code\"}\n#### Load Packages ####\nbase::library(tidyverse) \nbase::library(png)\n#### Load Data ####\nremotes::install_github(\"nrennie/LondonMarathon\")\ndata(winners, package = \"LondonMarathon\")\n\n#### Clean Data ####\ndata <- clean(winners)\n\n#### Create Data Visual ####\ndata_vis <- vis(data)\n\n#### Style Data Visual ####\nsty_vis <- style(data_vis)\n\n#### Add Flags ####\nsty_vis_with_flags <- add_flags(sty_vis)\n\n#### Save Plot ####\nggsave(\n  \"plot.png\", \n  width = 30, \n  height = 20, \n  units = \"cm\")\n```\n:::\n\n\n### Links\n\n[Week 17 Submission](https://github.com/rbolt13/tidytuesday/tree/main/2023/week_17) \n\n[TidyTuesday Repository](https://github.com/rbolt13/tidytuesday).\n\n:::\n\n# Quick Notes\n\n* Download images from wikimedia with `utils::download.file(url = \"\", destfile = \"\", mode = \"wb)`. \n\n* Add images to data visual with `ggplot2::annotation_custion()` and `grid::rasterGrob`. \n\n\n* `ggplot2::labs()` reads markdown such as newline, `\\n`.\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}